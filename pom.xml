<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
     <modelVersion>4.0.0</modelVersion>

     <properties>
          <maven.compiler.source>1.7</maven.compiler.source>
          <maven.compiler.target>1.7</maven.compiler.target>
          <zapp.version>0.0.1</zapp.version>
          <jersey.version>1.15</jersey.version>
          <mockito.version>1.9.5</mockito.version>
          <junit.version>4.11</junit.version>
          <spring.version>3.2.1.RELEASE</spring.version>
          <dropwizard.version>0.6.2</dropwizard.version>
          <!--<guava.version>14.0.1</guava.version> -->
          <!--<jackson.version>2.1.4</jackson.version> -->
     </properties>

     <groupId>org.zenoss</groupId>
     <artifactId>central-query</artifactId>
     <version>0.0.1</version>
     <dependencies>
          <dependency>
               <groupId>org.zenoss.zapp</groupId>
               <artifactId>zenoss-app</artifactId>
               <version>${zapp.version}</version>
          </dependency>
          <!--test scope -->
          <dependency>
               <groupId>junit</groupId>
               <artifactId>junit</artifactId>
               <version>${junit.version}</version>
               <scope>test</scope>
          </dependency>
          <dependency>
               <groupId>com.yammer.dropwizard</groupId>
               <artifactId>dropwizard-testing</artifactId>
               <version>${dropwizard.version}</version>
               <scope>test</scope>
          </dependency>
          <dependency>
               <groupId>org.springframework</groupId>
               <artifactId>spring-test</artifactId>
               <version>${spring.version}</version>
               <scope>test</scope>
          </dependency>
          <dependency>
               <groupId>com.github.tomakehurst</groupId>
               <artifactId>wiremock</artifactId>
               <version>1.33</version>
               <!-- Include this if you have dependency conflicts for Guava, 
                    Jetty, Jackson or Apache HTTP Client -->
               <classifier>standalone</classifier>
               <scope>test</scope>
          </dependency>
          <dependency>
               <groupId>org.apache.commons</groupId>
               <artifactId>commons-io</artifactId>
               <version>1.3.2</version>
               <scope>test</scope>
          </dependency>
          <!--runtime -->
          <dependency>
               <groupId>com.sun.jersey</groupId>
               <artifactId>jersey-server</artifactId>
               <version>${jersey.version}</version>
               <scope>runtime</scope>
          </dependency>
     </dependencies>

     <build>
          <plugins>
               <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>exec-maven-plugin</artifactId>
                    <version>1.2.1</version>
                    <configuration>
                         <mainClass>org.zenoss.app.query.QueryApp</mainClass>
                         <arguments>
                              <argument>server</argument>
                              <argument>configuration.yaml</argument>
                         </arguments>
                    </configuration>
               </plugin>
               <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-surefire-plugin</artifactId>
                    <version>2.12</version>
               </plugin>
               <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-compiler-plugin</artifactId>
                    <version>2.4</version>
                    <configuration>
                         <source>${maven.compiler.source}</source>
                         <target>${maven.compiler.target}</target>
                         <testSource>${maven.compiler.source}</testSource>
                         <testTarget>${maven.compiler.target}</testTarget>
                    </configuration>
               </plugin>
               <plugin>
                    <groupId>org.jacoco</groupId>
                    <artifactId>jacoco-maven-plugin</artifactId>
                    <version>0.6.3.201306030806</version>
                    <executions>
                         <execution>
                              <id>prepare-agent</id>
                              <goals>
                                   <goal>prepare-agent</goal>
                              </goals>
                         </execution>
                         <execution>
                              <id>report</id>
                              <phase>prepare-package</phase>
                              <goals>
                                   <goal>report</goal>
                              </goals>
                         </execution>
                         <execution>
                              <id>check</id>
                              <goals>
                                   <goal>check</goal>
                              </goals>
                              <configuration>
                                   <rules>
                                        <rule>
                                             <element>BUNDLE</element>
                                             <limits>
                                                  <limit>
                                                       <counter>COMPLEXITY</counter>
                                                       <value>COVEREDRATIO</value>
                                                       <minimum>0.50</minimum>
                                                  </limit>
                                             </limits>
                                        </rule>
                                   </rules>
                              </configuration>
                         </execution>
                    </executions>
               </plugin>
               <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-shade-plugin</artifactId>
                    <version>2.0</version>
                    <configuration>
                         <createDependencyReducedPom>false</createDependencyReducedPom>
                         <filters>
                              <filter>
                                   <artifact>*</artifact>
                                   <excludes>
                                        <exclude>META-INF/*.SF</exclude>
                                        <exclude>META-INF/*.RSA</exclude>
                                        <exclude>META-INF/*.INF</exclude>
                                   </excludes>
                              </filter>
                         </filters>
                    </configuration>
                    <executions>
                         <execution>
                              <phase>package</phase>
                              <goals>
                                   <goal>shade</goal>
                              </goals>
                              <configuration>
                                   <transformers>
                                        <transformer
                                             implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer" />
                                        <transformer
                                             implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                                             <mainClass>org.zenoss.app.query.QueryApp</mainClass>
                                        </transformer>
                                        <transformer
                                             implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer">
                                             <resource>META-INF/spring.handlers</resource>
                                        </transformer>
                                        <transformer
                                             implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer">
                                             <resource>META-INF/spring.schemas</resource>
                                        </transformer>
                                   </transformers>
                              </configuration>
                         </execution>
                    </executions>
               </plugin>
               <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>keytool-maven-plugin</artifactId>
                    <version>1.0</version>
                    <executions>
                         <execution>
                              <phase>generate-resources</phase>
                              <id>clean</id>
                              <goals>
                                   <goal>clean</goal>
                              </goals>
                         </execution>
                         <execution>
                              <phase>generate-resources</phase>
                              <id>genkey</id>
                              <goals>
                                   <goal>genkey</goal>
                              </goals>
                         </execution>
                    </executions>
                    <configuration>
                         <keystore>${project.build.directory}/ssl.pfx</keystore>
                         <dname>cn=localhost</dname>
                         <keypass>zapp_pass</keypass>
                         <storepass>zapp_pass</storepass>
                         <alias>zapp</alias>
                         <keyalg>RSA</keyalg>
                         <storetype>pkcs12</storetype>
                    </configuration>
               </plugin>
          </plugins>
     </build>
     <repositories>
          <repository>
               <id>zenoss-nexus</id>
               <name>Internal Zenoss Nexus</name>
               <url>http://cmrepo.zenoss.loc/nexus/content/groups/public</url>
               <snapshots>
                    <updatePolicy>always</updatePolicy>
               </snapshots>
          </repository>
     </repositories>
</project>
